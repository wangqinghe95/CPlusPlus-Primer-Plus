# Shell 脚本编程

## chapter 1

### chapter 1-1 脚本文件的书写格式

1. 以 #!/bin/bash 开头
2. 单行注释以 # 开头，多行注释以 <<[STRING] [STRING] 格式

### chapter 1-2 脚本的执行方式

1. 脚本执行方法
    1. ./[script_name]
    2. source [script_name]
    3. bash [script_name]
    4. sh [script_name]
    5. . [script_name]
2. 注意文件执行权限
3. pstree 查看进程树
4. 脚本运行的方法中，方法 1/3/4 会在 bash 进程中再起一个子进程来运行脚本，而 2/5 则直接在当前进程中运行脚本

### chapter 1-3 输入输出

#### echo

1. echo [string] 输出打印信息
    + string 会以空格为分隔符分为多个条目
    + 引号内部的内容会被认为是一个条目
    + 转义字符需要加参数 -e 才能被识别
    + 可以通过转移字符控制输出的大小，颜色，格式等字体属性

#### printf

1. printf 的用法可以等同认为是 C/C++ 中的printf用法
    + 支持输出格式
    + 支持输出宽度

#### read

1. read 从标准输入读取一行数据
    + read [options] [variable]
    + options:
        1. -p: 显示提示信息
        2. -t: 设置读入数据的超时时间
        3. -n: 设置读取 n 个字符后结束
        4. -r: 支持读取 \
        5. -s: 静默模式

### 1-4 输入输出重定向

### 1-5 引号使用

1. 单引号引起来的内容被视为一个整体，不被引起来的内容会被空格分为分成若干个条目
2. 双引号引起来的内容可以转义，单引号的转移字符会被直接打印
    + \ 字符也可以转移，只能转移一个字符，双引号内的所有转义字符都会被翻译
3. 反引号是命令替换字符，可以在双引号中使用单引号引入命令的执行
4. 反引号和单引号容易混淆，不支持嵌套，所以有 $() 可以代替单引号的命令替换功能

## 1-6 变量

1. 变量定义时等号两边不能有空格
    + 变量名称是由字母，数字和下划线构成，且不能由数字开头
    + 读取变量使用符号 '$'
    + 变量和非变量在一起时（没有空格隔开），需要使用 ‘{}’分割
    + 取消变量定义，可以使用unset删除
2. 常见的系统预设变量
    + UID: 当前账户的ID号
    + USER: 当前账户的名称
    + HISTSIZE: 当前终端的最大历史命令条目数量
    + HOME: 当前账号的根目录
    + LANG: 当前环境使用的语言
    + PATH：命令搜索路径
    + PWD: 当前工作路径
    + RANDOM: 随机返回 0-32767 的整数
    + $0: 返回当前命令的名称
    + $n: 返回位置参数，$1表示第一个参数，数字大于9时必须使用${n}
    + $#: 命令参数的个数
    + $@: 命令行的所有参数
    + $?: 返回上一条命令退出时的状态码（一般来说0表示正确，非0表示失败）
    + $$: 返回当前进程的进程号
    + $!: 返回最好一个进程的进程号

## 1-7 grep

1. grep
    + 查看关键字并打印匹配的行
    + grep [options] pattern [file]
        + options:
            1. -i: 忽略大小写
            2. -v: 取反匹配
            3. -w: 匹配单词
            4. -q: 静默匹配，不将结果显示在屏幕上
    + 正则表达式及其含义
        + c: 匹配字母c
        + .: 陪陪单个任意字符
        + *: 匹配前一个字符出现零次或者多次
        + .*: 匹配多个任意字符
        + []: 匹配集合中的任意单个字符，括号可以是任意数字字母的集合
        + [x-y]: 匹配连续的字符串范围
        + ^: 匹配字符串开头
        + $: 匹配字符串结尾
        + [^]: 匹配否定，对括号内的集合取反
        + \: 匹配转义后的字符串
        + \{n,m\}: 匹配前一个字符重复 n 到 m 次
        + \{n,\}: 匹配前一个字符至少 n 次
        + \{n\}: 匹配前一个字符 n 次
        + \(\): 将\(\)之间的内容存储在“保留空间”，最多存储9个
        + \n: 通过 \1到 \9调用保留空间中的内容
    + 样例
        + grep "root" /tmp/passwd
            + 在/tmp/passwd 文件中查找包含root的行
        + grep ":..0:" /tmp/passwd
            + 在/tmp/passwd 文件中查找符合字符'0'与字符"0:"之间包含任意两个字符条件的行
        + grep "00*" /tmp/passwd
            + 在/tmp/passwd 文件中查找至少包含一个0的行（第一个0必须出现，第二个0可以出现0次或者多次）
        + grep "o[os]" /tmp/passwd
            + 在/tmp/passwd 文件中查找 oot 或者 ost 的行
        + grep "[0-9]" /tmp/passwd
            + 在/tmp/passwd 文件中查找包含数字的行
        + grep "[f-q]" /tmp/passwd
            + 在/tmp/passwd 文件中查找包含字母f~q的行，（范围内任意字符都可）
        + grep "bash$" /tmp/passwd
            + 在/tmp/passwd 文件中查找以bash字符串结尾的行
        + grep "sbin/[^n]" /tmp/passwd
            + 在/tmp/passwd 文件中查找 sbin/ 后不跟字母 n 的行
        + grep "0\{1,2\}" /tmp/passwd
            + 在/tmp/passwd 文件中查找数字 0 出现次数在[1,2]次之间的行
        + grep "\(root\).*\1" /tmp/passwd
            + 在/tmp/passwd 文件中查找有两个root的行
        + grep "^$" /tmp/passwd
            + 在/tmp/passwd 文件中过滤空白行

2. 计算
    + 常见的运算符号：等同C/C++
    + let 进行数字运算
        + let 运行不会直接显示，需要保持到变量中
    + 小数运算需要使用 bc 命令

## chapter 2

### chapter 2-1 智能化脚本测试的基础

1. shell 中条件判断的方法
    + [[expression]]、[expression]、test
    + 条件表达式可以测试文件属性，进行字符或者数字比较
2. 条件判断不会有默认结果输出
    + echo $? 查看上一条命令的退出码
        + 0 运行成功，非 0 运行失败
    + && 或者 || 结合上一条命令进行结果的输出操作
3. 表达式两边需要有空格
    + 在 [[]] 和 test 进行排序比较时，使用的比较符不同
    + test 和 [] 中不能直接使用 <> 进行排序比较
4. A 命令;B 命令
    + 先执行 A 命令，再执行 B 命令，整个命令的退出码以 B 命令为准
5. A 命令 && B 命令
    + 先执行 A 命令，如果 A 命令执行成功，则执行 B 命令，如果 A 命令失败，则不执行 B 命令
    + 若 AB 命令都执行成功，则退出码为 0，否则为非 0
6. A || B
    + A 执行成功则不执行 B，否则执行 B
    + 两条命令有一条返回 0，则返回0，否则返回 1

### chapter 2-2 字符串的判断和比较

1. 字符串判断和比较的方法
    + 使用 test 和 [], 效果等同
2. 常用的字符串运算符
    1. = : 检查两个字符串是否相等，相等返回 true
    2. != : 检查两个字符串不想等，不想等返回 true
    3. -z : 检查字符串长度是否为 0， 为 0 返回 true
    4. -n : 检查字符串长度不为 0，不为 0 返回 true
    5. $ : 检查字符是否不为空， 不为空返回 true

### chapter 2-3 整数的判断与比较
